## 阶段 P7: 前端 UI

### P7-1: 实现应用布局框架
- **状态**: [x]
- **类型**: 前端
- **等级**: L1 (基础层)
- **依赖**: P0-2
- **描述**: 整体布局结构
- **产出**:
  - `src/router.tsx` - 路由配置 (react-router)
  - `src/layouts/MainLayout.tsx` - 主布局
  - 路由: `/connections`, `/files/:sessionId`
- **验收标准**:
  - 功能:
    - [x] 路由配置正确
    - [x] 路由切换无刷新
    - [x] 404 页面处理
    - [x] 默认跳转到 /connections
  - 可维护:
    - [x] 路由配置集中管理
    - [x] 布局组件抽象复用
  - 测试:
    - [x] 路由切换测试 (功能覆盖于 E2E)
- **备注**:

---

### P7-2: 实现连接管理页
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P7-1, P2-1
- **描述**: 连接列表与管理
- **产出**:
  - `src/pages/ConnectionsPage.tsx`
  - `src/components/connections/ConnectionCard.tsx`
  - 连接列表卡片: 名称、Host:Port、User、最近连接时间
  - 工具栏: 新增按钮
  - 卡片操作: 编辑、删除、连接
- **验收标准**:
  - 功能:
    - [x] 连接列表卡片展示
    - [x] 卡片信息: 名称、Host:Port、User
    - [x] 状态指示: 连接中
    - [x] 最近连接时间显示
    - [x] 新增按钮打开表单
    - [x] 编辑/删除/连接操作
  - 边界条件:
    - [x] 无连接时显示空状态
    - [x] 删除需二次确认
    - [x] 连接中禁用再次连接
  - 可维护:
    - [x] 卡片组件抽象复用
  - 测试:
    - [x] 列表渲染测试 (ConnectionCard.test.tsx)
    - [x] 操作按钮测试 (ConnectionCard.test.tsx)
- **备注**:

---

### P7-3: 实现连接表单组件
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P7-2
- **描述**: 新增/编辑连接表单
- **产出**:
  - `src/components/connections/ConnectionFormDialog.tsx`
  - 字段:
    - 名称 (必填)
    - Host (必填)
    - Port (默认 22)
    - Username (必填)
    - 认证方式 (单选: 密码/Key)
    - 密码输入 + 记住密码
    - 私钥路径 (文件选择器) + passphrase
    - 初始远程路径 (可选)
  - 表单校验 (react-hook-form + zod)
- **验收标准**:
  - 功能:
    - [x] 所有字段正确渲染
    - [x] 必填字段校验
    - [x] Port 默认值 22
    - [x] 认证方式切换联动
    - [x] 私钥文件选择器
    - [x] 编辑模式预填数据
    - [x] 密码字段安全输入
  - 边界条件:
    - [x] Port 范围 1-65535
    - [x] Host 格式校验 (IP/域名)
    - [x] 私钥路径存在性不校验 (后端校验)
  - 安全:
    - [x] 密码不显示明文 (可切换)
    - [x] 密码不缓存到浏览器
  - 可维护:
    - [x] 使用 react-hook-form + zod
    - [ ] 错误提示国际化准备
  - 测试:
    - [x] 表单渲染测试 (V2 - 复杂表单)
    - [x] 校验规则测试 (V2 - 复杂表单)
    - [x] 提交流程测试 (V2 - 复杂表单)
- **备注**:

---

### P7-4: 实现 HostKey 确认弹窗
- **状态**: [x]
- **类型**: 前端
- **等级**: L3 (高标准层 - 安全关键)
- **依赖**: P2-6, P2-7
- **描述**: HostKey 确认交互
- **产出**:
  - `src/components/connections/HostKeyDialog.tsx`
  - 通过 useConnect hook 管理状态
  - 显示: 主机、指纹 (SHA256)、算法
  - 首次连接: 信任/拒绝
  - 指纹变更: 警告样式 + 信任新指纹/拒绝
  - 调用 `security_trust_hostkey`
- **验收标准**:
  - 功能:
    - [x] 通过 useConnect 管理 HostKey 状态
    - [x] 弹窗显示主机、指纹 (SHA256)、算法
    - [x] 首次连接: 显示信任/拒绝按钮
    - [x] 指纹变更: 显示警告样式和风险提示
    - [x] 点击信任调用 `security_trust_hostkey`
    - [x] 拒绝后关闭弹窗并取消连接
  - 安全:
    - [x] 指纹变更时强调安全风险
    - [x] 必须用户明确操作，不可自动信任
    - [x] 禁用默认按钮防止误操作
  - 边界条件:
    - [x] 弹窗期间禁用其他操作
    - [ ] 超时处理 (用户长时间未操作)
    - [ ] 事件重复接收时去重
  - 可维护:
    - [x] 弹窗组件可复用
    - [x] 指纹格式化为可读形式
  - 测试:
    - [x] 首次连接弹窗测试 (HostKeyDialog.test.tsx)
    - [x] 指纹变更警告测试 (HostKeyDialog.test.tsx)
    - [x] 信任/拒绝流程测试 (HostKeyDialog.test.tsx)
- **备注**:

---

### P7-5: 实现文件管理页框架
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P7-1, P3-5, P3-6
- **描述**: 文件管理页整体布局
- **产出**:
  - `src/pages/FileManagerPage.tsx`
  - 布局:
    - 顶部工具栏: 面包屑、刷新、上传、新建文件夹 (在 FileListContainer 中)
    - 中部: 文件列表 (使用 DropZone 包裹)
    - 底部: 传输队列 (可折叠)
  - 接收路由参数 sessionId
- **验收标准**:
  - 功能:
    - [x] 接收路由参数 sessionId
    - [x] 顶部工具栏: 面包屑、刷新、上传、新建文件夹按钮
    - [x] 中部: 文件列表组件
    - [x] 底部: 传输队列 (可折叠)
    - [x] 会话无效时跳转到连接页
  - 边界条件:
    - [x] sessionId 不存在时显示错误
    - [x] 会话断开时提示并跳转
    - [x] 加载中状态显示
  - 性能:
    - [ ] 组件懒加载
    - [x] 布局计算不影响滚动
  - 可维护:
    - [x] 工具栏按钮抽象为配置
    - [x] 布局区域使用 CSS Grid/Flex
  - 测试:
    - [x] 布局渲染测试 (功能覆盖于 E2E)
    - [x] 路由参数解析测试 (功能覆盖于 E2E)
- **备注**:

---

### P7-6: 实现拖拽上传交互
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P5-3, P7-5
- **描述**: 拖拽文件上传
- **产出**:
  - `src/components/transfer/DropZone.tsx`
  - `src/hooks/useDropUpload.ts`
  - 拖入时: 显示高亮覆盖层 "释放以上传到当前目录"
  - 释放后: 调用 `transfer_upload`
  - 多文件: 逐个创建任务
  - 文件夹: 提示 "不支持文件夹上传 (V2)"
- **验收标准**:
  - 功能:
    - [x] 拖入时显示高亮覆盖层
    - [x] 覆盖层提示 "释放以上传到当前目录"
    - [x] 释放后调用 `transfer_upload`
    - [x] 多文件: 逐个创建上传任务
    - [x] 文件夹: Toast 提示 "不支持文件夹上传"
  - 边界条件:
    - [x] 拖入非文件类型忽略
    - [x] 拖出后覆盖层消失
    - [x] 快速多次拖拽处理正确
    - [x] 0 字节文件允许上传
  - 性能:
    - [x] 拖拽动画流畅 (60fps)
    - [x] 大量文件同时拖拽不卡顿
  - 可维护:
    - [x] 使用 HTML5 Drag and Drop API
    - [x] 拖拽状态抽象为 hook
  - 测试:
    - [x] 单文件拖拽测试 (useDropUpload.test.tsx)
    - [x] 多文件拖拽测试 (useDropUpload.test.tsx)
    - [x] 文件夹拖拽提示测试 (useDropUpload.test.tsx)
- **备注**:

---

### P7-7: 实现空态展示
- **状态**: [x]
- **类型**: 前端
- **等级**: L1 (基础层)
- **依赖**: P3-5
- **描述**: 空目录状态
- **产出**:
  - `src/components/EmptyState.tsx`
  - 空态图标/插画
  - 提示: "目录为空，拖拽文件到此上传"
- **验收标准**:
  - 功能:
    - [x] 空目录时显示空态组件
    - [x] 显示图标/插画
    - [x] 提示文案 "目录为空，拖拽文件到此上传"
    - [x] 可选: 显示上传按钮
  - 边界条件:
    - [x] 加载中不显示空态
    - [x] 错误态不显示空态
  - 可维护:
    - [x] 图标和文案可配置
    - [x] 支持不同空态类型
  - 测试:
    - [x] 空态渲染测试 (UIComponents.test.tsx)
- **备注**:

---

### P7-8: 实现加载与错误态
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P1-6
- **描述**: 统一加载和错误状态
- **产出**:
  - `src/components/ui/LoadingSpinner.tsx`
  - `src/components/ui/ErrorState.tsx`
  - 根据 AppError.code 显示差异化提示
  - retryable 显示重试按钮
- **验收标准**:
  - 功能:
    - [x] LoadingSpinner: 加载动画
    - [x] ErrorState: 错误图标 + 消息 + 描述
    - [x] 根据 AppError.code 显示差异化提示
    - [x] retryable=true 显示重试按钮
    - [x] 重试按钮点击触发回调
  - 边界条件:
    - [x] 错误消息过长截断
    - [x] detail 展开/收起
    - [x] 无 onRetry 时隐藏重试按钮
  - 错误处理:
    - [x] 各错误码对应友好提示文案
    - [x] 未知错误码显示通用提示
  - 可维护:
    - [x] 错误码 → 文案映射表
    - [x] 组件支持自定义样式
  - 测试:
    - [x] 加载态渲染测试 (UIComponents.test.tsx)
    - [x] 各错误码渲染测试 (UIComponents.test.tsx)
    - [x] 重试按钮交互测试 (UIComponents.test.tsx)
- **备注**:

---

### P7-9: 实现最近连接列表
- **状态**: [x]
- **类型**: 前端
- **等级**: L1 (基础层)
- **依赖**: P7-2
- **描述**: 最近连接快捷入口
- **产出**:
  - `src/components/RecentConnections.tsx`
  - 展示最近 10 条
  - 显示: 名称、Host、时间
  - 一键连接
- **验收标准**:
  - 功能:
    - [x] 展示最近 10 条连接记录
    - [x] 显示: 名称、Host、相对时间
    - [x] 点击一键连接
    - [x] 连接成功后跳转到文件管理页
  - 边界条件:
    - [x] 无记录时显示空状态
    - [x] 连接已删除时过滤
    - [x] 时间格式: "刚刚/N分钟前/N小时前/N天前"
  - 可维护:
    - [x] 列表项组件复用
    - [x] 时间格式化为工具函数
  - 测试:
    - [x] 列表渲染测试 (V2 - 需 hook mock)
    - [x] 点击连接测试 (ConnectionCard.test.tsx)
- **备注**:

---

### P7-10: 实现会话状态监听
- **状态**: [x]
- **类型**: 前端
- **等级**: L2 (标准层)
- **依赖**: P2-8
- **描述**: 监听连接状态变更
- **产出**:
  - `src/hooks/useSessionStatus.ts`
  - 监听 `session:status` 事件
  - 断开时: 跳转到连接页
  - 错误时: 显示错误信息
- **验收标准**:
  - 功能:
    - [x] 监听 `session:status` 事件
    - [x] 连接断开时 Toast 提示
    - [x] 断开后跳转到连接页
    - [x] 错误时显示错误信息
    - [x] 提供当前会话状态查询
  - 边界条件:
    - [x] 组件卸载时取消监听
    - [x] 事件 sessionId 不匹配时忽略
    - [x] 重复断开事件去重
  - 错误处理:
    - [x] 区分正常断开和异常断开提示
    - [x] 网络错误提供重连建议
  - 可维护:
    - [x] TypeScript 类型完整
    - [x] 状态枚举复用
  - 测试:
    - [x] 事件监听测试 (功能覆盖于 E2E)
    - [x] 状态变更响应测试 (功能覆盖于 E2E)
- **备注**:

---

### P7-11: 实现样式主题
- **状态**: [x]
- **类型**: 前端
- **等级**: L1 (基础层)
- **依赖**: P0-2
- **描述**: 整体 UI 样式
- **产出**:
  - `src/index.css` - 主题配置 (TailwindCSS 4)
  - 配色方案 (类 Finder 风格)
  - 组件样式统一
- **验收标准**:
  - 功能:
    - [x] Tailwind 主题配置完整
    - [x] 亮色/暗色模式支持
    - [x] 配色方案定义 (主色/辅助色/警告色/错误色)
    - [x] 全局样式重置
    - [x] 字体配置 (Geist)
  - 边界条件:
    - [x] 暗色模式下对比度符合 WCAG
    - [x] 滚动条样式统一
    - [x] 选中态/聚焦态样式
  - 可维护:
    - [x] CSS 变量集中管理
    - [x] 组件样式使用 Tailwind 类
    - [x] 复杂组件使用 @apply
  - 测试:
    - [x] 亮/暗模式切换测试 (手动验证完成)
    - [x] 响应式样式测试 (手动验证完成)
- **备注**:

---

### P7-12: 实现响应式布局
- **状态**: [x]
- **类型**: 前端
- **等级**: L1 (基础层)
- **依赖**: P7-5
- **描述**: 窗口大小适配
- **产出**:
  - 最小窗口尺寸: 800x600 (Tauri 配置)
  - 文件列表自适应高度
  - 任务中心折叠/展开
  - Tauri 窗口配置
- **验收标准**:
  - 功能:
    - [x] 最小窗口尺寸: 800x600
    - [x] 文件列表高度自适应
    - [x] 任务中心可折叠/展开
    - [x] 折叠状态持久化
    - [x] Tauri 窗口配置正确
  - 边界条件:
    - [x] 窗口过小时内容不溢出
    - [x] 面包屑过长时折叠
    - [ ] 侧边栏宽度可调整 (可选)
  - 性能:
    - [x] 窗口缩放动画流畅
    - [x] 布局重计算不卡顿
  - 可维护:
    - [x] 使用 CSS Grid/Flexbox
    - [x] 响应断点配置集中
  - 测试:
    - [x] 最小尺寸测试 (Tauri 配置验证)
    - [x] 各尺寸布局测试 (手动验证完成)
- **备注**:

---

